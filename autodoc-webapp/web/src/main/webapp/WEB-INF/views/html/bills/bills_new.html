<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html"
      xmlns:th="http:/www.w3.org/1999/xhtml">


<div th:replace="fragments/header :: head1"></div>
<body>
<div class="container">
    <div th:replace="fragments/navbar :: navbar"></div>

    <div th:replace="fragments/menu :: menu"></div>

    <h3>New bill</h3>


    <form action="#" method="post" th:action="@{'/bills/new/'}" th:object="${billForm}">
        <span id="myForm"></span>
        <div class="form-group">
            <label for="employeeLogin">Employee:</label>
            <input class="form-control" id="employeeLogin" name="employeeLogin" placeholder="Enter Employee Login"
                   required="required" th:value="${billForm.employeeLogin}" type="text"/>
            <div th:errors="*{employeeLogin}" th:if="${#fields.hasErrors('employeeLogin')}">Employee Error</div>
        </div>

        <div class="form-group">
            <label for="carRegistration">Registration:</label>
            <input class="form-control" id="carRegistration" name="carRegistration" placeholder="Enter Registration"
                   required="required" th:value="${billForm.carRegistration}" type="text"/>
            <div th:errors="*{carRegistration}" th:if="${#fields.hasErrors('carRegistration')}">Registration Error</div>
        </div>


        <div class="form-group">
            <div class="input-group date" data-target-input="nearest" id="datetimepicker1">
                <input class="form-control datetimepicker-input" data-target="#datetimepicker1" name="dateReparation"
                       type="text"/>
                <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker"
                     id="dateReparation" name="dateReparation">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>


        <div class="form-group">
            <label for="discount">Discount:</label>
            <input class="form-control" id="discount" name="discount" placeholder="Enter Discount" required="required"
                   value="0"
                   type="text"/>
            <div th:errors="*{discount}" th:if="${#fields.hasErrors('discount')}">Discount Error</div>
        </div>

        <div class="form-group">
            <label for="comments">Comments:</label>
            <input class="form-control" id="comments" name="comments" placeholder="Enter Comments" required="required"
                   type="text"/>
            <div th:errors="*{comments}" th:if="${#fields.hasErrors('comments')}">Comments Error</div>
        </div>

        <input required="required" th:field="*{vat}" type="hidden"/>
        <input required="required" th:field="*{status}" type="hidden"/>
        <input required="required" th:field="*{clientId}" type="hidden"/>

        <div class="form-group" th:each="task, stat : ${taskList}">
            <label for="taskList">Tasks:</label>
            <select class="form-control" id="taskList" th:name="|tasks.list[${stat.index}]|" th:value="${task}">
                <option value="">add Task</option>
                <option th:each="task : ${taskList}"
                        th:utext="${task.getName()}"
                        th:value="${task.getId()}"/>
            </select>
        </div>
        <button onclick="pieceFunction()">Add Piece</button>
        <br><br>
        <span id="myPieces"></span>


        <!--  <div class="form-group" th:each="piece, stat : ${pieceList}">
              <label for="pieceList">Pieces:</label>
              <select class="form-control" id="pieceList" th:name="|pieces.list[${stat.index}]|" th:value="${piece}">
                  <option value="">add Piece</option>
                  <option th:each="piece : ${pieceList}"
                          th:utext="${piece.getName()}"
                          th:value="${piece.getId()}"/>
              </select>
          </div>-->

        <button class="btn btn-primary" type="submit">Submit</button>

    </form>

    <script th:inline="javascript">
        function getPieces() {


            /*<![CDATA[*/

            var pieces = /*[[${pieces}]]*/ null;

            /*]]>*/
            return pieces;
        }
    </script>


    <script>
        var i = 0; /* Set Global Variable i */
        function increment() {
            i += 1; /* Function for automatic increment of field's "Name" attribute. */
        }

        /*
        ---------------------------------------------

        Function to Remove Form Elements Dynamically
        ---------------------------------------------

        */
        function removeElement(parentDiv, childDiv) {
            if (childDiv == parentDiv) {
                alert("The parent div cannot be removed.");
            } else if (document.getElementById(childDiv)) {
                var child = document.getElementById(childDiv);
                var parent = document.getElementById(parentDiv);
                parent.removeChild(child);
            } else {
                alert("Child div has already been removed or does not exist.");
                return false;
            }
        }


        /*
        ----------------------------------------------------------------------------

        Functions that will be called upon, when user click on the Piece text field.

        ----------------------------------------------------------------------------
        */
        function pieceFunction() {
            let pieces = getPieces();

            let r = document.createElement('div');
            let y = document.createElement("SELECT");
            r.className += "form-group";
            y.className += "form-control";
            r.setAttribute("id", "pieceList");


            for (k = 0; k < pieces.length; k++) {
                let z = document.createElement("option");
                z.setAttribute("value", pieces[k].id);
                let t = document.createTextNode(pieces[k].name);
                z.appendChild(t);
                y.appendChild(z);
            }


            let g = document.createElement("button");
            g.innerHTML = "X";
            increment();
            y.setAttribute("id", "pieceList");
            y.setAttribute("name", "pieces.list[" + i + "]");
            r.appendChild(y);
            g.setAttribute("onclick", "removeElement('myPieces','id_" + i + "')");
            r.appendChild(g);
            r.setAttribute("id", "id_" + i);
            document.getElementById("myPieces").appendChild(r);
        }


        /*
        -----------------------------------------------------------------------------

        Functions that will be called upon, when user click on the Reset Button.

        ------------------------------------------------------------------------------
        *//*
        function resetElements() {
            document.getElementById('myForm').innerHTML = '';
        }*/


        //var today = new Date();
        $("#datetimepicker1").datetimepicker({
            format: 'DD/MM/YYYY hh:mm',
            autoClose: true,
            todayBtn: true,
            minuteStep: 10


        });
    </script>

</div>
</body>
</html>




